<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CO2115 Week 5 – Protected Page (Demo)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.5; margin: 2rem; }
    .card { max-width: 860px; border: 1px solid #ddd; border-radius: 12px; padding: 1.25rem 1.5rem; }
    code { background: #f6f6f6; padding: 0.1rem 0.3rem; border-radius: 6px; }
    button { padding: 0.55rem 0.9rem; border-radius: 10px; border: 1px solid #bbb; background: white; cursor: pointer; }
    .row { display: flex; gap: 0.75rem; flex-wrap: wrap; align-items: center; }
    .ok { color: #0b6; font-weight: 700; }
    .bad { color: #b30; font-weight: 700; }
    .muted { color: #555; }
    .box { background: #fafafa; border: 1px solid #eee; border-radius: 10px; padding: 0.75rem 1rem; }
    .small { font-size: 0.95rem; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Protected Page (Demo)</h1>
    <p class="muted">
      This page checks for a cookie called <code>demo_session</code>.
      If the cookie is missing, it shows a “not logged in” state.
    </p>

    <div class="box" id="resultBox">
      <p id="resultLine"></p>
      <p class="small muted" id="detailLine"></p>
    </div>

    <h2>Actions</h2>
    <div class="row">
      <button id="backBtn">Back to login demo</button>
      <button id="logoutBtn">Clear demo cookie (log out)</button>
      <button id="refreshBtn">Refresh page</button>
    </div>

    <h2>What to observe (for the lab)</h2>
    <ul class="small">
      <li>With the cookie present, this page shows “Access granted”.</li>
      <li>Delete the cookie in DevTools (or click “Clear demo cookie”), then refresh: it should show “Not logged in”.</li>
    </ul>
  </div>

<script>
  function clearDemoCookie() {
    document.cookie = "demo_session=; Max-Age=0; Path=/; SameSite=Lax";
  }

  function getDemoCookie() {
    const parts = document.cookie.split(";").map(s => s.trim());
    for (const p of parts) {
      if (p.startsWith("demo_session=")) return p.substring("demo_session=".length);
    }
    return null;
  }

  function render() {
    const token = getDemoCookie();
    const resultLine = document.getElementById("resultLine");
    const detailLine = document.getElementById("detailLine");

    if (token) {
      resultLine.innerHTML = '<span class="ok">Access granted (demo)</span>';
      detailLine.textContent = "demo_session cookie value: " + token;
    } else {
      resultLine.innerHTML = '<span class="bad">Not logged in (demo)</span>';
      detailLine.textContent = "No demo_session cookie found. In a real system, you would normally be redirected to a login page.";
    }
  }

  document.getElementById("backBtn").addEventListener("click", () => {
    window.location.href = "./login_demo.html";
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    clearDemoCookie();
    render();
  });

  document.getElementById("refreshBtn").addEventListener("click", () => {
    window.location.reload();
  });

  render();
</script>
</body>
</html>
